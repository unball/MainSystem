<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />
<meta name="generator" content="pdoc 0.7.2" />
<title>MainSystem.controller API documentation</title>
<meta name="description" content="" />
<link href='https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.0/normalize.min.css' rel='stylesheet'>
<link href='https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/8.0.0/sanitize.min.css' rel='stylesheet'>
<link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css" rel="stylesheet">
<style>.flex{display:flex !important}body{line-height:1.5em}#content{padding:20px}#sidebar{padding:30px;overflow:hidden}.http-server-breadcrumbs{font-size:130%;margin:0 0 15px 0}#footer{font-size:.75em;padding:5px 30px;border-top:1px solid #ddd;text-align:right}#footer p{margin:0 0 0 1em;display:inline-block}#footer p:last-child{margin-right:30px}h1,h2,h3,h4,h5{font-weight:300}h1{font-size:2.5em;line-height:1.1em}h2{font-size:1.75em;margin:1em 0 .50em 0}h3{font-size:1.4em;margin:25px 0 10px 0}h4{margin:0;font-size:105%}a{color:#058;text-decoration:none;transition:color .3s ease-in-out}a:hover{color:#e82}.title code{font-weight:bold}h2[id^="header-"]{margin-top:2em}.ident{color:#900}pre code{background:#f8f8f8;font-size:.8em;line-height:1.4em}code{background:#f2f2f1;padding:1px 4px;overflow-wrap:break-word}h1 code{background:transparent}pre{background:#f8f8f8;border:0;border-top:1px solid #ccc;border-bottom:1px solid #ccc;margin:1em 0;padding:1ex}#http-server-module-list{display:flex;flex-flow:column}#http-server-module-list div{display:flex}#http-server-module-list dt{min-width:10%}#http-server-module-list p{margin-top:0}.toc ul,#index{list-style-type:none;margin:0;padding:0}#index code{background:transparent}#index h3{border-bottom:1px solid #ddd}#index ul{padding:0}#index h4{font-weight:bold}#index h4 + ul{margin-bottom:.6em}@media (min-width:200ex){#index .two-column{column-count:2}}@media (min-width:300ex){#index .two-column{column-count:3}}dl{margin-bottom:2em}dl dl:last-child{margin-bottom:4em}dd{margin:0 0 1em 3em}#header-classes + dl > dd{margin-bottom:3em}dd dd{margin-left:2em}dd p{margin:10px 0}.name{background:#eee;font-weight:bold;font-size:.85em;padding:5px 10px;display:inline-block;min-width:40%}.name:hover{background:#e0e0e0}.name > span:first-child{white-space:nowrap}.name.class > span:nth-child(2){margin-left:.4em}.inherited{color:#999;border-left:5px solid #eee;padding-left:1em}.inheritance em{font-style:normal;font-weight:bold}.desc h2{font-weight:400;font-size:1.25em}.desc h3{font-size:1em}.desc dt code{background:inherit}.source summary,.git-link-div{color:#666;text-align:right;font-weight:400;font-size:.8em;text-transform:uppercase}.source summary > *{white-space:nowrap;cursor:pointer}.git-link{color:inherit;margin-left:1em}.source pre{max-height:500px;overflow:auto;margin:0}.source pre code{font-size:12px;overflow:visible}.hlist{list-style:none}.hlist li{display:inline}.hlist li:after{content:',\2002'}.hlist li:last-child:after{content:none}.hlist .hlist{display:inline;padding-left:1em}img{max-width:100%}.admonition{padding:.1em .5em;margin-bottom:1em}.admonition-title{font-weight:bold}.admonition.note,.admonition.info,.admonition.important{background:#aef}.admonition.todo,.admonition.versionadded,.admonition.tip,.admonition.hint{background:#dfd}.admonition.warning,.admonition.versionchanged,.admonition.deprecated{background:#fd4}.admonition.error,.admonition.danger,.admonition.caution{background:lightpink}</style>
<style media="screen and (min-width: 700px)">@media screen and (min-width:700px){#sidebar{width:30%}#content{width:70%;max-width:100ch;padding:3em 4em;border-left:1px solid #ddd}pre code{font-size:1em}.item .name{font-size:1em}main{display:flex;flex-direction:row-reverse;justify-content:flex-end}.toc ul ul,#index ul{padding-left:1.5em}.toc > ul > li{margin-top:.5em}}</style>
<style media="print">@media print{#sidebar h1{page-break-before:always}.source{display:none}}@media print{*{background:transparent !important;color:#000 !important;box-shadow:none !important;text-shadow:none !important}a[href]:after{content:" (" attr(href) ")";font-size:90%}a[href][title]:after{content:none}abbr[title]:after{content:" (" attr(title) ")"}.ir a:after,a[href^="javascript:"]:after,a[href^="#"]:after{content:""}pre,blockquote{border:1px solid #999;page-break-inside:avoid}thead{display:table-header-group}tr,img{page-break-inside:avoid}img{max-width:100% !important}@page{margin:0.5cm}p,h2,h3{orphans:3;widows:3}h1,h2,h3,h4,h5,h6{page-break-after:avoid}}</style>
<script async src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS_CHTML'></script>
</head>
<body>
<main>
<article id="content">
<header>
<h1 class="title">Module <code>MainSystem.controller</code></h1>
</header>
<section id="section-intro">
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">from threading import Thread
import queue
from gi.repository import GLib

from controller.vision.mainVision import MainVision
from controller.control.NLC import NLC
from controller.communication.rosRadio import RosRadio
from controller.communication.rosHandler import RosHandler
from controller.states import DummyState
from controller.world import World

class Controller:
  &#34;&#34;&#34;Classe que declara a thread do backend e define o estado do sistema&#34;&#34;&#34;
  
  def __init__(self):
    self.__thread = Thread(target=self.loop)
    &#34;&#34;&#34;Thread que executa o backend do sistema&#34;&#34;&#34;
    
    self.__state = DummyState(self)
    &#34;&#34;&#34;Estado atual do sistema&#34;&#34;&#34;
    
    self.__quitRequested = False
    &#34;&#34;&#34;Flag que indica se o loop do backend deve terminar&#34;&#34;&#34;
    
    self.__events = queue.Queue()
    &#34;&#34;&#34;Eventos agendados. Essa fila é útil para que a view agende eventos a serem executados no momento oportuno pelo backend, evitando condições de corrida.&#34;&#34;&#34;
    
    self.world = World()
    &#34;&#34;&#34;Essa é uma instância do mundo. O mundo contém informações sobre estado do campo como posição de robôs, velocidades, posição de bola e limites do campo.&#34;&#34;&#34;
    
    self.visionSystem = MainVision(self.world)
    &#34;&#34;&#34;Instância do sistema de visão&#34;&#34;&#34;
    
    self.controlSystem = NLC(self.world)
    &#34;&#34;&#34;Instância do sistema de controle&#34;&#34;&#34;
    
    self.communicationSystem = RosRadio(self.world)
    &#34;&#34;&#34;Instância do sistema que se comunica com o rádio&#34;&#34;&#34;
    
    self.__thread.start()
  
  def addEvent(self, method, *args, run_when_done_with_glib=None):
    &#34;&#34;&#34;Adiciona um evento a fila de eventos agendados para serem executados no início do próximo loop do backend. Se `run_when_done_with_glib` estiver definido como a tupla `(method,args)` o método dessa tupla será executado depois que o evento for executado.&#34;&#34;&#34;
    self.__events.put({&#34;method&#34;: method, &#34;args&#34;: args, &#34;glib_run&#34;: run_when_done_with_glib})
  
  def runQueuedEvents(self):
    &#34;&#34;&#34;Método que executa eventos agendados&#34;&#34;&#34;
    
    while not self.__events.empty():
      try:
        event = self.__events.get_nowait()
        event[&#34;method&#34;](*event[&#34;args&#34;])
        if event[&#34;glib_run&#34;] is not None:
          GLib.idle_add(event[&#34;glib_run&#34;][0], *event[&#34;glib_run&#34;][1:])
      except:
        print(&#34;Failed to run queued event&#34;)
            
  def stop(self):
    &#34;&#34;&#34;Faz a flag `__quitRequested` ser `True`, o que provocará a parada de `loop` na thread de controller.&#34;&#34;&#34;
    self.__quitRequested = True
    
  def setState(self, state):
    &#34;&#34;&#34;Define o estado que será executado no `loop`&#34;&#34;&#34;
    self.__state = state
    
  def unsetState(self):
    &#34;&#34;&#34;Define que o estado a ser executado no `loop` é um estado que não faz nada.&#34;&#34;&#34;
    self.__state = DummyState(self)
  
  def loop(self):
    &#34;&#34;&#34;Loop principal da thread de backend&#34;&#34;&#34;
    
    while not self.__quitRequested:
      # Executa eventos agendados
      self.runQueuedEvents()
      
      # Executa o update do estado atual
      self.__state.update()
    
    # Para o rosHandler, se tiver sido habilitado
    RosHandler().terminateAll()
    </code></pre>
</details>
</section>
<section>
<h2 class="section-title" id="header-submodules">Sub-modules</h2>
<dl>
<dt><code class="name"><a title="MainSystem.controller.communication" href="communication/index.html">MainSystem.controller.communication</a></code></dt>
<dd>
<section class="desc"></section>
</dd>
<dt><code class="name"><a title="MainSystem.controller.control" href="control/index.html">MainSystem.controller.control</a></code></dt>
<dd>
<section class="desc"></section>
</dd>
<dt><code class="name"><a title="MainSystem.controller.states" href="states/index.html">MainSystem.controller.states</a></code></dt>
<dd>
<section class="desc"></section>
</dd>
<dt><code class="name"><a title="MainSystem.controller.strategy" href="strategy/index.html">MainSystem.controller.strategy</a></code></dt>
<dd>
<section class="desc"></section>
</dd>
<dt><code class="name"><a title="MainSystem.controller.vision" href="vision/index.html">MainSystem.controller.vision</a></code></dt>
<dd>
<section class="desc"></section>
</dd>
<dt><code class="name"><a title="MainSystem.controller.world" href="world/index.html">MainSystem.controller.world</a></code></dt>
<dd>
<section class="desc"></section>
</dd>
</dl>
</section>
<section>
</section>
<section>
</section>
<section>
<h2 class="section-title" id="header-classes">Classes</h2>
<dl>
<dt id="MainSystem.controller.Controller"><code class="flex name class">
<span>class <span class="ident">Controller</span></span>
</code></dt>
<dd>
<section class="desc"><p>Classe que declara a thread do backend e define o estado do sistema</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">class Controller:
  &#34;&#34;&#34;Classe que declara a thread do backend e define o estado do sistema&#34;&#34;&#34;
  
  def __init__(self):
    self.__thread = Thread(target=self.loop)
    &#34;&#34;&#34;Thread que executa o backend do sistema&#34;&#34;&#34;
    
    self.__state = DummyState(self)
    &#34;&#34;&#34;Estado atual do sistema&#34;&#34;&#34;
    
    self.__quitRequested = False
    &#34;&#34;&#34;Flag que indica se o loop do backend deve terminar&#34;&#34;&#34;
    
    self.__events = queue.Queue()
    &#34;&#34;&#34;Eventos agendados. Essa fila é útil para que a view agende eventos a serem executados no momento oportuno pelo backend, evitando condições de corrida.&#34;&#34;&#34;
    
    self.world = World()
    &#34;&#34;&#34;Essa é uma instância do mundo. O mundo contém informações sobre estado do campo como posição de robôs, velocidades, posição de bola e limites do campo.&#34;&#34;&#34;
    
    self.visionSystem = MainVision(self.world)
    &#34;&#34;&#34;Instância do sistema de visão&#34;&#34;&#34;
    
    self.controlSystem = NLC(self.world)
    &#34;&#34;&#34;Instância do sistema de controle&#34;&#34;&#34;
    
    self.communicationSystem = RosRadio(self.world)
    &#34;&#34;&#34;Instância do sistema que se comunica com o rádio&#34;&#34;&#34;
    
    self.__thread.start()
  
  def addEvent(self, method, *args, run_when_done_with_glib=None):
    &#34;&#34;&#34;Adiciona um evento a fila de eventos agendados para serem executados no início do próximo loop do backend. Se `run_when_done_with_glib` estiver definido como a tupla `(method,args)` o método dessa tupla será executado depois que o evento for executado.&#34;&#34;&#34;
    self.__events.put({&#34;method&#34;: method, &#34;args&#34;: args, &#34;glib_run&#34;: run_when_done_with_glib})
  
  def runQueuedEvents(self):
    &#34;&#34;&#34;Método que executa eventos agendados&#34;&#34;&#34;
    
    while not self.__events.empty():
      try:
        event = self.__events.get_nowait()
        event[&#34;method&#34;](*event[&#34;args&#34;])
        if event[&#34;glib_run&#34;] is not None:
          GLib.idle_add(event[&#34;glib_run&#34;][0], *event[&#34;glib_run&#34;][1:])
      except:
        print(&#34;Failed to run queued event&#34;)
            
  def stop(self):
    &#34;&#34;&#34;Faz a flag `__quitRequested` ser `True`, o que provocará a parada de `loop` na thread de controller.&#34;&#34;&#34;
    self.__quitRequested = True
    
  def setState(self, state):
    &#34;&#34;&#34;Define o estado que será executado no `loop`&#34;&#34;&#34;
    self.__state = state
    
  def unsetState(self):
    &#34;&#34;&#34;Define que o estado a ser executado no `loop` é um estado que não faz nada.&#34;&#34;&#34;
    self.__state = DummyState(self)
  
  def loop(self):
    &#34;&#34;&#34;Loop principal da thread de backend&#34;&#34;&#34;
    
    while not self.__quitRequested:
      # Executa eventos agendados
      self.runQueuedEvents()
      
      # Executa o update do estado atual
      self.__state.update()
    
    # Para o rosHandler, se tiver sido habilitado
    RosHandler().terminateAll()</code></pre>
</details>
<h3>Instance variables</h3>
<dl>
<dt id="MainSystem.controller.Controller.__thread"><code class="name">var <span class="ident">__thread</span></code></dt>
<dd>
<section class="desc"><p>Thread que executa o backend do sistema</p></section>
</dd>
<dt id="MainSystem.controller.Controller.__state"><code class="name">var <span class="ident">__state</span></code></dt>
<dd>
<section class="desc"><p>Estado atual do sistema</p></section>
</dd>
<dt id="MainSystem.controller.Controller.__quitRequested"><code class="name">var <span class="ident">__quitRequested</span></code></dt>
<dd>
<section class="desc"><p>Flag que indica se o loop do backend deve terminar</p></section>
</dd>
<dt id="MainSystem.controller.Controller.__events"><code class="name">var <span class="ident">__events</span></code></dt>
<dd>
<section class="desc"><p>Eventos agendados. Essa fila é útil para que a view agende eventos a serem executados no momento oportuno pelo backend, evitando condições de corrida.</p></section>
</dd>
<dt id="MainSystem.controller.Controller.world"><code class="name">var <span class="ident">world</span></code></dt>
<dd>
<section class="desc"><p>Essa é uma instância do mundo. O mundo contém informações sobre estado do campo como posição de robôs, velocidades, posição de bola e limites do campo.</p></section>
</dd>
<dt id="MainSystem.controller.Controller.visionSystem"><code class="name">var <span class="ident">visionSystem</span></code></dt>
<dd>
<section class="desc"><p>Instância do sistema de visão</p></section>
</dd>
<dt id="MainSystem.controller.Controller.controlSystem"><code class="name">var <span class="ident">controlSystem</span></code></dt>
<dd>
<section class="desc"><p>Instância do sistema de controle</p></section>
</dd>
<dt id="MainSystem.controller.Controller.communicationSystem"><code class="name">var <span class="ident">communicationSystem</span></code></dt>
<dd>
<section class="desc"><p>Instância do sistema que se comunica com o rádio</p></section>
</dd>
</dl>
<h3>Methods</h3>
<dl>
<dt id="MainSystem.controller.Controller.addEvent"><code class="name flex">
<span>def <span class="ident">addEvent</span></span>(<span>self, method, *args, run_when_done_with_glib=None)</span>
</code></dt>
<dd>
<section class="desc"><p>Adiciona um evento a fila de eventos agendados para serem executados no início do próximo loop do backend. Se <code>run_when_done_with_glib</code> estiver definido como a tupla <code>(method,args)</code> o método dessa tupla será executado depois que o evento for executado.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def addEvent(self, method, *args, run_when_done_with_glib=None):
  &#34;&#34;&#34;Adiciona um evento a fila de eventos agendados para serem executados no início do próximo loop do backend. Se `run_when_done_with_glib` estiver definido como a tupla `(method,args)` o método dessa tupla será executado depois que o evento for executado.&#34;&#34;&#34;
  self.__events.put({&#34;method&#34;: method, &#34;args&#34;: args, &#34;glib_run&#34;: run_when_done_with_glib})</code></pre>
</details>
</dd>
<dt id="MainSystem.controller.Controller.runQueuedEvents"><code class="name flex">
<span>def <span class="ident">runQueuedEvents</span></span>(<span>self)</span>
</code></dt>
<dd>
<section class="desc"><p>Método que executa eventos agendados</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def runQueuedEvents(self):
  &#34;&#34;&#34;Método que executa eventos agendados&#34;&#34;&#34;
  
  while not self.__events.empty():
    try:
      event = self.__events.get_nowait()
      event[&#34;method&#34;](*event[&#34;args&#34;])
      if event[&#34;glib_run&#34;] is not None:
        GLib.idle_add(event[&#34;glib_run&#34;][0], *event[&#34;glib_run&#34;][1:])
    except:
      print(&#34;Failed to run queued event&#34;)</code></pre>
</details>
</dd>
<dt id="MainSystem.controller.Controller.stop"><code class="name flex">
<span>def <span class="ident">stop</span></span>(<span>self)</span>
</code></dt>
<dd>
<section class="desc"><p>Faz a flag <code>__quitRequested</code> ser <code>True</code>, o que provocará a parada de <code>loop</code> na thread de controller.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def stop(self):
  &#34;&#34;&#34;Faz a flag `__quitRequested` ser `True`, o que provocará a parada de `loop` na thread de controller.&#34;&#34;&#34;
  self.__quitRequested = True</code></pre>
</details>
</dd>
<dt id="MainSystem.controller.Controller.setState"><code class="name flex">
<span>def <span class="ident">setState</span></span>(<span>self, state)</span>
</code></dt>
<dd>
<section class="desc"><p>Define o estado que será executado no <code>loop</code></p></section>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def setState(self, state):
  &#34;&#34;&#34;Define o estado que será executado no `loop`&#34;&#34;&#34;
  self.__state = state</code></pre>
</details>
</dd>
<dt id="MainSystem.controller.Controller.unsetState"><code class="name flex">
<span>def <span class="ident">unsetState</span></span>(<span>self)</span>
</code></dt>
<dd>
<section class="desc"><p>Define que o estado a ser executado no <code>loop</code> é um estado que não faz nada.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def unsetState(self):
  &#34;&#34;&#34;Define que o estado a ser executado no `loop` é um estado que não faz nada.&#34;&#34;&#34;
  self.__state = DummyState(self)</code></pre>
</details>
</dd>
<dt id="MainSystem.controller.Controller.loop"><code class="name flex">
<span>def <span class="ident">loop</span></span>(<span>self)</span>
</code></dt>
<dd>
<section class="desc"><p>Loop principal da thread de backend</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def loop(self):
  &#34;&#34;&#34;Loop principal da thread de backend&#34;&#34;&#34;
  
  while not self.__quitRequested:
    # Executa eventos agendados
    self.runQueuedEvents()
    
    # Executa o update do estado atual
    self.__state.update()
  
  # Para o rosHandler, se tiver sido habilitado
  RosHandler().terminateAll()</code></pre>
</details>
</dd>
</dl>
</dd>
</dl>
</section>
</article>
<nav id="sidebar">
<h1>Index</h1>
<div class="toc">
<ul></ul>
</div>
<ul id="index">
<li><h3>Super-module</h3>
<ul>
<li><code><a title="MainSystem" href="../index.html">MainSystem</a></code></li>
</ul>
</li>
<li><h3><a href="#header-submodules">Sub-modules</a></h3>
<ul>
<li><code><a title="MainSystem.controller.communication" href="communication/index.html">MainSystem.controller.communication</a></code></li>
<li><code><a title="MainSystem.controller.control" href="control/index.html">MainSystem.controller.control</a></code></li>
<li><code><a title="MainSystem.controller.states" href="states/index.html">MainSystem.controller.states</a></code></li>
<li><code><a title="MainSystem.controller.strategy" href="strategy/index.html">MainSystem.controller.strategy</a></code></li>
<li><code><a title="MainSystem.controller.vision" href="vision/index.html">MainSystem.controller.vision</a></code></li>
<li><code><a title="MainSystem.controller.world" href="world/index.html">MainSystem.controller.world</a></code></li>
</ul>
</li>
<li><h3><a href="#header-classes">Classes</a></h3>
<ul>
<li>
<h4><code><a title="MainSystem.controller.Controller" href="#MainSystem.controller.Controller">Controller</a></code></h4>
<ul class="two-column">
<li><code><a title="MainSystem.controller.Controller.addEvent" href="#MainSystem.controller.Controller.addEvent">addEvent</a></code></li>
<li><code><a title="MainSystem.controller.Controller.runQueuedEvents" href="#MainSystem.controller.Controller.runQueuedEvents">runQueuedEvents</a></code></li>
<li><code><a title="MainSystem.controller.Controller.stop" href="#MainSystem.controller.Controller.stop">stop</a></code></li>
<li><code><a title="MainSystem.controller.Controller.setState" href="#MainSystem.controller.Controller.setState">setState</a></code></li>
<li><code><a title="MainSystem.controller.Controller.unsetState" href="#MainSystem.controller.Controller.unsetState">unsetState</a></code></li>
<li><code><a title="MainSystem.controller.Controller.loop" href="#MainSystem.controller.Controller.loop">loop</a></code></li>
<li><code><a title="MainSystem.controller.Controller.__thread" href="#MainSystem.controller.Controller.__thread">__thread</a></code></li>
<li><code><a title="MainSystem.controller.Controller.__state" href="#MainSystem.controller.Controller.__state">__state</a></code></li>
<li><code><a title="MainSystem.controller.Controller.__quitRequested" href="#MainSystem.controller.Controller.__quitRequested">__quitRequested</a></code></li>
<li><code><a title="MainSystem.controller.Controller.__events" href="#MainSystem.controller.Controller.__events">__events</a></code></li>
<li><code><a title="MainSystem.controller.Controller.world" href="#MainSystem.controller.Controller.world">world</a></code></li>
<li><code><a title="MainSystem.controller.Controller.visionSystem" href="#MainSystem.controller.Controller.visionSystem">visionSystem</a></code></li>
<li><code><a title="MainSystem.controller.Controller.controlSystem" href="#MainSystem.controller.Controller.controlSystem">controlSystem</a></code></li>
<li><code><a title="MainSystem.controller.Controller.communicationSystem" href="#MainSystem.controller.Controller.communicationSystem">communicationSystem</a></code></li>
</ul>
</li>
</ul>
</li>
</ul>
</nav>
</main>
<footer id="footer">
<p>Generated by <a href="https://pdoc3.github.io/pdoc"><cite>pdoc</cite> 0.7.2</a>.</p>
</footer>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
<script>hljs.initHighlightingOnLoad()</script>
</body>
</html>