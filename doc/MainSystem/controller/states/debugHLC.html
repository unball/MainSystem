<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />
<meta name="generator" content="pdoc 0.7.2" />
<title>MainSystem.controller.states.debugHLC API documentation</title>
<meta name="description" content="" />
<link href='https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.0/normalize.min.css' rel='stylesheet'>
<link href='https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/8.0.0/sanitize.min.css' rel='stylesheet'>
<link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css" rel="stylesheet">
<style>.flex{display:flex !important}body{line-height:1.5em}#content{padding:20px}#sidebar{padding:30px;overflow:hidden}.http-server-breadcrumbs{font-size:130%;margin:0 0 15px 0}#footer{font-size:.75em;padding:5px 30px;border-top:1px solid #ddd;text-align:right}#footer p{margin:0 0 0 1em;display:inline-block}#footer p:last-child{margin-right:30px}h1,h2,h3,h4,h5{font-weight:300}h1{font-size:2.5em;line-height:1.1em}h2{font-size:1.75em;margin:1em 0 .50em 0}h3{font-size:1.4em;margin:25px 0 10px 0}h4{margin:0;font-size:105%}a{color:#058;text-decoration:none;transition:color .3s ease-in-out}a:hover{color:#e82}.title code{font-weight:bold}h2[id^="header-"]{margin-top:2em}.ident{color:#900}pre code{background:#f8f8f8;font-size:.8em;line-height:1.4em}code{background:#f2f2f1;padding:1px 4px;overflow-wrap:break-word}h1 code{background:transparent}pre{background:#f8f8f8;border:0;border-top:1px solid #ccc;border-bottom:1px solid #ccc;margin:1em 0;padding:1ex}#http-server-module-list{display:flex;flex-flow:column}#http-server-module-list div{display:flex}#http-server-module-list dt{min-width:10%}#http-server-module-list p{margin-top:0}.toc ul,#index{list-style-type:none;margin:0;padding:0}#index code{background:transparent}#index h3{border-bottom:1px solid #ddd}#index ul{padding:0}#index h4{font-weight:bold}#index h4 + ul{margin-bottom:.6em}@media (min-width:200ex){#index .two-column{column-count:2}}@media (min-width:300ex){#index .two-column{column-count:3}}dl{margin-bottom:2em}dl dl:last-child{margin-bottom:4em}dd{margin:0 0 1em 3em}#header-classes + dl > dd{margin-bottom:3em}dd dd{margin-left:2em}dd p{margin:10px 0}.name{background:#eee;font-weight:bold;font-size:.85em;padding:5px 10px;display:inline-block;min-width:40%}.name:hover{background:#e0e0e0}.name > span:first-child{white-space:nowrap}.name.class > span:nth-child(2){margin-left:.4em}.inherited{color:#999;border-left:5px solid #eee;padding-left:1em}.inheritance em{font-style:normal;font-weight:bold}.desc h2{font-weight:400;font-size:1.25em}.desc h3{font-size:1em}.desc dt code{background:inherit}.source summary,.git-link-div{color:#666;text-align:right;font-weight:400;font-size:.8em;text-transform:uppercase}.source summary > *{white-space:nowrap;cursor:pointer}.git-link{color:inherit;margin-left:1em}.source pre{max-height:500px;overflow:auto;margin:0}.source pre code{font-size:12px;overflow:visible}.hlist{list-style:none}.hlist li{display:inline}.hlist li:after{content:',\2002'}.hlist li:last-child:after{content:none}.hlist .hlist{display:inline;padding-left:1em}img{max-width:100%}.admonition{padding:.1em .5em;margin-bottom:1em}.admonition-title{font-weight:bold}.admonition.note,.admonition.info,.admonition.important{background:#aef}.admonition.todo,.admonition.versionadded,.admonition.tip,.admonition.hint{background:#dfd}.admonition.warning,.admonition.versionchanged,.admonition.deprecated{background:#fd4}.admonition.error,.admonition.danger,.admonition.caution{background:lightpink}</style>
<style media="screen and (min-width: 700px)">@media screen and (min-width:700px){#sidebar{width:30%}#content{width:70%;max-width:100ch;padding:3em 4em;border-left:1px solid #ddd}pre code{font-size:1em}.item .name{font-size:1em}main{display:flex;flex-direction:row-reverse;justify-content:flex-end}.toc ul ul,#index ul{padding-left:1.5em}.toc > ul > li{margin-top:.5em}}</style>
<style media="print">@media print{#sidebar h1{page-break-before:always}.source{display:none}}@media print{*{background:transparent !important;color:#000 !important;box-shadow:none !important;text-shadow:none !important}a[href]:after{content:" (" attr(href) ")";font-size:90%}a[href][title]:after{content:none}abbr[title]:after{content:" (" attr(title) ")"}.ir a:after,a[href^="javascript:"]:after,a[href^="#"]:after{content:""}pre,blockquote{border:1px solid #999;page-break-inside:avoid}thead{display:table-header-group}tr,img{page-break-inside:avoid}img{max-width:100% !important}@page{margin:0.5cm}p,h2,h3{orphans:3;widows:3}h1,h2,h3,h4,h5,h6{page-break-after:avoid}}</style>
<script async src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS_CHTML'></script>
</head>
<body>
<main>
<article id="content">
<header>
<h1 class="title">Module <code>MainSystem.controller.states.debugHLC</code></h1>
</header>
<section id="section-intro">
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">from controller.states import State
from controller.strategy.trajectory import StraightLine, Dubins
import numpy as np
import time

class Individuo():
  def __init__(self, params):
    self.params = params
    self.adequacao = 0
    
  @property
  def ka(self):
    return self.params[0]
    
  @property
  def kg(self):
    return self.params[1]
    
  @property
  def kp(self):
    return self.params[2]

class AG():
  def __init__(self, size):
    self.currentIndividuo = 0
    
    self.weights = [10,500,5]
    self.min = [4, 0, 7]
    
    self.initialGen = [{&#34;ka&#34;: 5.837680521958922, &#34;kg&#34;: 118.99659632111248, &#34;kp&#34;: 5.870844036094553},
{&#34;ka&#34;: 1.1172688438443967, &#34;kg&#34;: 109.4501515549437, &#34;kp&#34;: 5.9396152856884},
{&#34;ka&#34;: 6.699208305468581, &#34;kg&#34;: 382.8649280089019, &#34;kp&#34;: 2.377935126960727},
{&#34;ka&#34;: 5.837680521958922, &#34;kg&#34;: 133.61676185098975, &#34;kp&#34;: 4.555786188293416},
{&#34;ka&#34;: 5.837680521958922, &#34;kg&#34;: 118.99659632111248, &#34;kp&#34;: 5.870844036094553},
{&#34;ka&#34;: 5.837680521958922, &#34;kg&#34;: 133.61676185098975, &#34;kp&#34;: 4.555786188293416},
{&#34;ka&#34;: 5.617773757461554, &#34;kg&#34;: 14.683103375551232, &#34;kp&#34;: 5.9396152856884},
{&#34;ka&#34;: 5.617773757461554, &#34;kg&#34;: 14.683103375551232, &#34;kp&#34;: 5.9396152856884},
{&#34;ka&#34;: 5.837680521958922, &#34;kg&#34;: 118.99659632111248, &#34;kp&#34;: 5.870844036094553},
{&#34;ka&#34;: 5.617773757461554, &#34;kg&#34;: 14.683103375551232, &#34;kp&#34;: 5.9396152856884},
{&#34;ka&#34;: 5.837680521958922, &#34;kg&#34;: 14.683103375551232, &#34;kp&#34;: 5.9396152856884},
{&#34;ka&#34;: 4.7270998549824705, &#34;kg&#34;: 118.99659632111248, &#34;kp&#34;: 5.870844036094553},
{&#34;ka&#34;: 5.837680521958922, &#34;kg&#34;: 118.99659632111248, &#34;kp&#34;: 5.870844036094553},
{&#34;ka&#34;: 5.837680521958922, &#34;kg&#34;: 118.99659632111248, &#34;kp&#34;: 5.870844036094553},
{&#34;ka&#34;: 5.837680521958922, &#34;kg&#34;: 118.99659632111248, &#34;kp&#34;: 5.870844036094553},
{&#34;ka&#34;: 5.837680521958922, &#34;kg&#34;: 118.99659632111248, &#34;kp&#34;: 2.5297938123647503},
{&#34;ka&#34;: 5.837680521958922, &#34;kg&#34;: 118.99659632111248, &#34;kp&#34;: 5.870844036094553},
{&#34;ka&#34;: 5.837680521958922, &#34;kg&#34;: 133.61676185098975, &#34;kp&#34;: 4.555786188293416},
{&#34;ka&#34;: 5.837680521958922, &#34;kg&#34;: 118.99659632111248, &#34;kp&#34;: 9.385447667773759},
{&#34;ka&#34;: 5.837680521958922, &#34;kg&#34;: 118.99659632111248, &#34;kp&#34;: 5.870844036094553}]
    
    self.individuos = [Individuo([self.weights[0]*np.random.rand()+self.min[0], self.weights[1]*np.random.rand()+self.min[1], self.weights[2]*np.random.rand() + self.min[2]]) for i in range(size)]
    #self.individuos = [Individuo([self.initialGen[i][&#34;ka&#34;], self.initialGen[i][&#34;kg&#34;], self.initialGen[i][&#34;kp&#34;]]) for i in range(size)]
  
    
  def setAdequacao(self, valor):
    self.individuos[self.currentIndividuo].adequacao = valor
    self.currentIndividuo = self.currentIndividuo + 1
    
    # Fim do experimento com todos os indivíduos
    if self.currentIndividuo == len(self.individuos):
      self.reproduzir()
      self.currentIndividuo = 0
      
  def getIndividuo(self):
    return self.individuos[self.currentIndividuo]
    
  def corrigirAdequacao(self):
    maiorAdequacao = max(self.individuos, key=lambda x: x.adequacao).adequacao
    soma = 0
    for i in range(len(self.individuos)):
      self.individuos[i].adequacao = maiorAdequacao-self.individuos[i].adequacao
      soma = soma + self.individuos[i].adequacao
    return soma
    
    
  def encontrarIndividuo(self, regioes, prob):
    for i in range(len(self.individuos)):
      if regioes[i][0] &lt;= prob and regioes[i][1] &gt;= prob:
        return i
    return None
      
  def reproduzir(self):
    somaAdequacao = self.corrigirAdequacao()
    
    print(&#34;Resultado indivíduos:&#34;)
    for individuo in sorted(self.individuos, key=lambda x:-x.adequacao):
      print(&#34;Adequação: {3}\tka: {0}\tkg: {1}\tkp: {2}&#34;.format(individuo.ka, individuo.kg, individuo.kp, individuo.adequacao))
      
    listaRegiaoProb = []
    probAnt = 0
    for i in range(len(self.individuos)):
      prob = self.individuos[i].adequacao/somaAdequacao
      listaRegiaoProb.append((probAnt,probAnt+prob))
      probAnt = probAnt+prob
      
    print(listaRegiaoProb)
    
    pais = []
    maes = []
    for i in range(len(self.individuos)//2):
      pais.append(self.individuos[self.encontrarIndividuo(listaRegiaoProb, np.random.rand())])
      maes.append(self.individuos[self.encontrarIndividuo(listaRegiaoProb, np.random.rand())])
    
    novosIndividuos = []
    for i in range(len(self.individuos)//2):
      pc = np.random.rand()
      if pc &gt; 0.7:
        locus = np.random.randint(3)+1
        novosIndividuos.append(Individuo(pais[i].params[:locus]+maes[i].params[locus:3]))
        novosIndividuos.append(Individuo(maes[i].params[:locus]+pais[i].params[locus:3]))
      else:
        novosIndividuos.append(Individuo(pais[i].params))
        novosIndividuos.append(Individuo(maes[i].params))
      
      for j in range(len(novosIndividuos[-1].params)):
        pm1 = np.random.rand()
        pm2 = np.random.rand()
        if pm1 &gt; 0.97:
          novosIndividuos[-1].params[j] = self.weights[j] * np.random.rand() + self.min[j]
        if pm2 &gt; 0.97:
          novosIndividuos[-2].params[j] = self.weights[j] * np.random.rand() + self.min[j]
    
    print(&#34;Novos indivíduos:&#34;)
    for individuo in novosIndividuos:
      print(&#34;ka: {0}\tkg: {1}\tkp: {2}&#34;.format(individuo.ka, individuo.kg, individuo.kp))
    
    self.individuos = novosIndividuos

class DebugHLC(State):
  &#34;&#34;&#34;Estado de debug HLC. Executa a visão, define trajetórias específicas para os robôs, passa um target ao controle de alto nível e envia sinal via rádio.&#34;&#34;&#34;
  
  def __init__(self, controller):
    super().__init__(controller)
    
    self.finalPoint = None
    self.ag = AG(20)
    self.adequacao = 0
    self.tin = 0
    

  def update(self):
    t0 = time.time()
    
    self._controller.visionSystem.update()
    
    robot = self._controller.world.robots[0]
    
    
    
    if self.finalPoint is None or (robot.x-self.finalPoint[0])**2 + (robot.y-self.finalPoint[1])**2 &lt; 0.07**2 or time.time()-self.tin &gt;= 5:
      
      if self._controller.world.running:
        # Fim do experimento
        #if self.tin != 0:
          #self.adequacao = self.adequacao + 50*(time.time()-self.tin)
          #print(&#34;Não adequação: &#34; + str(self.adequacao))
          #self.ag.setAdequacao(self.adequacao)
          #self.adequacao = 0
          #self._controller.communicationSystem.sendZero()
        
        # Inicio do experimento
        self.tin = time.time()
        #individuo = self.ag.getIndividuo()
        #self._controller.controlSystem.setConstantes(individuo.ka, individuo.kg, individuo.kp)
      
      self.finalPoint = (-np.sign(robot.x)*self._controller.world.field_x_length/2*0.70, 0, -np.pi/2)
      self.trajectory = Dubins(robot.pose, self.finalPoint, 0.15)
      
      #self.trajectory = StraightLine(robot.pose, (-robot.x, robot.y, -np.pi/2))
    
#    # Integra a adequacao do experimento
#    if self._controller.world.running:
#      rmin = self.trajectory.P(self.trajectory.tmin(robot.pose))
#      p = np.sqrt((robot.x-rmin[0])**2 + (robot.y-rmin[1])**2)
#      a = rmin[2]-robot.th
#      self.adequacao = self.adequacao + (p + abs(np.sin(a))/2)
    
    # Define uma trajetória
    robot.trajectory = self.trajectory
    
    # Obtém o target instantâneo
    targets = [robot.trajectory.target(robot.pose, robot.step)]
    
    # Obtém velocidade angular e linear
    speeds = self._controller.controlSystem.actuate(targets, [])
    
    # Envia os dados via rádio
    if self._controller.world.running:
      self._controller.communicationSystem.send(speeds)
    else: self._controller.communicationSystem.sendZero()
    
    
    #print(speeds[0])
    
    #print((time.time()-t0)*1000)
    
    </code></pre>
</details>
</section>
<section>
</section>
<section>
</section>
<section>
</section>
<section>
<h2 class="section-title" id="header-classes">Classes</h2>
<dl>
<dt id="MainSystem.controller.states.debugHLC.Individuo"><code class="flex name class">
<span>class <span class="ident">Individuo</span></span>
<span>(</span><span>params)</span>
</code></dt>
<dd>
<section class="desc"></section>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">class Individuo():
  def __init__(self, params):
    self.params = params
    self.adequacao = 0
    
  @property
  def ka(self):
    return self.params[0]
    
  @property
  def kg(self):
    return self.params[1]
    
  @property
  def kp(self):
    return self.params[2]</code></pre>
</details>
<h3>Instance variables</h3>
<dl>
<dt id="MainSystem.controller.states.debugHLC.Individuo.ka"><code class="name">var <span class="ident">ka</span></code></dt>
<dd>
<section class="desc"></section>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@property
def ka(self):
  return self.params[0]</code></pre>
</details>
</dd>
<dt id="MainSystem.controller.states.debugHLC.Individuo.kg"><code class="name">var <span class="ident">kg</span></code></dt>
<dd>
<section class="desc"></section>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@property
def kg(self):
  return self.params[1]</code></pre>
</details>
</dd>
<dt id="MainSystem.controller.states.debugHLC.Individuo.kp"><code class="name">var <span class="ident">kp</span></code></dt>
<dd>
<section class="desc"></section>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@property
def kp(self):
  return self.params[2]</code></pre>
</details>
</dd>
</dl>
</dd>
<dt id="MainSystem.controller.states.debugHLC.AG"><code class="flex name class">
<span>class <span class="ident">AG</span></span>
<span>(</span><span>size)</span>
</code></dt>
<dd>
<section class="desc"></section>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">class AG():
  def __init__(self, size):
    self.currentIndividuo = 0
    
    self.weights = [10,500,5]
    self.min = [4, 0, 7]
    
    self.initialGen = [{&#34;ka&#34;: 5.837680521958922, &#34;kg&#34;: 118.99659632111248, &#34;kp&#34;: 5.870844036094553},
{&#34;ka&#34;: 1.1172688438443967, &#34;kg&#34;: 109.4501515549437, &#34;kp&#34;: 5.9396152856884},
{&#34;ka&#34;: 6.699208305468581, &#34;kg&#34;: 382.8649280089019, &#34;kp&#34;: 2.377935126960727},
{&#34;ka&#34;: 5.837680521958922, &#34;kg&#34;: 133.61676185098975, &#34;kp&#34;: 4.555786188293416},
{&#34;ka&#34;: 5.837680521958922, &#34;kg&#34;: 118.99659632111248, &#34;kp&#34;: 5.870844036094553},
{&#34;ka&#34;: 5.837680521958922, &#34;kg&#34;: 133.61676185098975, &#34;kp&#34;: 4.555786188293416},
{&#34;ka&#34;: 5.617773757461554, &#34;kg&#34;: 14.683103375551232, &#34;kp&#34;: 5.9396152856884},
{&#34;ka&#34;: 5.617773757461554, &#34;kg&#34;: 14.683103375551232, &#34;kp&#34;: 5.9396152856884},
{&#34;ka&#34;: 5.837680521958922, &#34;kg&#34;: 118.99659632111248, &#34;kp&#34;: 5.870844036094553},
{&#34;ka&#34;: 5.617773757461554, &#34;kg&#34;: 14.683103375551232, &#34;kp&#34;: 5.9396152856884},
{&#34;ka&#34;: 5.837680521958922, &#34;kg&#34;: 14.683103375551232, &#34;kp&#34;: 5.9396152856884},
{&#34;ka&#34;: 4.7270998549824705, &#34;kg&#34;: 118.99659632111248, &#34;kp&#34;: 5.870844036094553},
{&#34;ka&#34;: 5.837680521958922, &#34;kg&#34;: 118.99659632111248, &#34;kp&#34;: 5.870844036094553},
{&#34;ka&#34;: 5.837680521958922, &#34;kg&#34;: 118.99659632111248, &#34;kp&#34;: 5.870844036094553},
{&#34;ka&#34;: 5.837680521958922, &#34;kg&#34;: 118.99659632111248, &#34;kp&#34;: 5.870844036094553},
{&#34;ka&#34;: 5.837680521958922, &#34;kg&#34;: 118.99659632111248, &#34;kp&#34;: 2.5297938123647503},
{&#34;ka&#34;: 5.837680521958922, &#34;kg&#34;: 118.99659632111248, &#34;kp&#34;: 5.870844036094553},
{&#34;ka&#34;: 5.837680521958922, &#34;kg&#34;: 133.61676185098975, &#34;kp&#34;: 4.555786188293416},
{&#34;ka&#34;: 5.837680521958922, &#34;kg&#34;: 118.99659632111248, &#34;kp&#34;: 9.385447667773759},
{&#34;ka&#34;: 5.837680521958922, &#34;kg&#34;: 118.99659632111248, &#34;kp&#34;: 5.870844036094553}]
    
    self.individuos = [Individuo([self.weights[0]*np.random.rand()+self.min[0], self.weights[1]*np.random.rand()+self.min[1], self.weights[2]*np.random.rand() + self.min[2]]) for i in range(size)]
    #self.individuos = [Individuo([self.initialGen[i][&#34;ka&#34;], self.initialGen[i][&#34;kg&#34;], self.initialGen[i][&#34;kp&#34;]]) for i in range(size)]
  
    
  def setAdequacao(self, valor):
    self.individuos[self.currentIndividuo].adequacao = valor
    self.currentIndividuo = self.currentIndividuo + 1
    
    # Fim do experimento com todos os indivíduos
    if self.currentIndividuo == len(self.individuos):
      self.reproduzir()
      self.currentIndividuo = 0
      
  def getIndividuo(self):
    return self.individuos[self.currentIndividuo]
    
  def corrigirAdequacao(self):
    maiorAdequacao = max(self.individuos, key=lambda x: x.adequacao).adequacao
    soma = 0
    for i in range(len(self.individuos)):
      self.individuos[i].adequacao = maiorAdequacao-self.individuos[i].adequacao
      soma = soma + self.individuos[i].adequacao
    return soma
    
    
  def encontrarIndividuo(self, regioes, prob):
    for i in range(len(self.individuos)):
      if regioes[i][0] &lt;= prob and regioes[i][1] &gt;= prob:
        return i
    return None
      
  def reproduzir(self):
    somaAdequacao = self.corrigirAdequacao()
    
    print(&#34;Resultado indivíduos:&#34;)
    for individuo in sorted(self.individuos, key=lambda x:-x.adequacao):
      print(&#34;Adequação: {3}\tka: {0}\tkg: {1}\tkp: {2}&#34;.format(individuo.ka, individuo.kg, individuo.kp, individuo.adequacao))
      
    listaRegiaoProb = []
    probAnt = 0
    for i in range(len(self.individuos)):
      prob = self.individuos[i].adequacao/somaAdequacao
      listaRegiaoProb.append((probAnt,probAnt+prob))
      probAnt = probAnt+prob
      
    print(listaRegiaoProb)
    
    pais = []
    maes = []
    for i in range(len(self.individuos)//2):
      pais.append(self.individuos[self.encontrarIndividuo(listaRegiaoProb, np.random.rand())])
      maes.append(self.individuos[self.encontrarIndividuo(listaRegiaoProb, np.random.rand())])
    
    novosIndividuos = []
    for i in range(len(self.individuos)//2):
      pc = np.random.rand()
      if pc &gt; 0.7:
        locus = np.random.randint(3)+1
        novosIndividuos.append(Individuo(pais[i].params[:locus]+maes[i].params[locus:3]))
        novosIndividuos.append(Individuo(maes[i].params[:locus]+pais[i].params[locus:3]))
      else:
        novosIndividuos.append(Individuo(pais[i].params))
        novosIndividuos.append(Individuo(maes[i].params))
      
      for j in range(len(novosIndividuos[-1].params)):
        pm1 = np.random.rand()
        pm2 = np.random.rand()
        if pm1 &gt; 0.97:
          novosIndividuos[-1].params[j] = self.weights[j] * np.random.rand() + self.min[j]
        if pm2 &gt; 0.97:
          novosIndividuos[-2].params[j] = self.weights[j] * np.random.rand() + self.min[j]
    
    print(&#34;Novos indivíduos:&#34;)
    for individuo in novosIndividuos:
      print(&#34;ka: {0}\tkg: {1}\tkp: {2}&#34;.format(individuo.ka, individuo.kg, individuo.kp))
    
    self.individuos = novosIndividuos</code></pre>
</details>
<h3>Methods</h3>
<dl>
<dt id="MainSystem.controller.states.debugHLC.AG.setAdequacao"><code class="name flex">
<span>def <span class="ident">setAdequacao</span></span>(<span>self, valor)</span>
</code></dt>
<dd>
<section class="desc"></section>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def setAdequacao(self, valor):
  self.individuos[self.currentIndividuo].adequacao = valor
  self.currentIndividuo = self.currentIndividuo + 1
  
  # Fim do experimento com todos os indivíduos
  if self.currentIndividuo == len(self.individuos):
    self.reproduzir()
    self.currentIndividuo = 0</code></pre>
</details>
</dd>
<dt id="MainSystem.controller.states.debugHLC.AG.getIndividuo"><code class="name flex">
<span>def <span class="ident">getIndividuo</span></span>(<span>self)</span>
</code></dt>
<dd>
<section class="desc"></section>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def getIndividuo(self):
  return self.individuos[self.currentIndividuo]</code></pre>
</details>
</dd>
<dt id="MainSystem.controller.states.debugHLC.AG.corrigirAdequacao"><code class="name flex">
<span>def <span class="ident">corrigirAdequacao</span></span>(<span>self)</span>
</code></dt>
<dd>
<section class="desc"></section>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def corrigirAdequacao(self):
  maiorAdequacao = max(self.individuos, key=lambda x: x.adequacao).adequacao
  soma = 0
  for i in range(len(self.individuos)):
    self.individuos[i].adequacao = maiorAdequacao-self.individuos[i].adequacao
    soma = soma + self.individuos[i].adequacao
  return soma</code></pre>
</details>
</dd>
<dt id="MainSystem.controller.states.debugHLC.AG.encontrarIndividuo"><code class="name flex">
<span>def <span class="ident">encontrarIndividuo</span></span>(<span>self, regioes, prob)</span>
</code></dt>
<dd>
<section class="desc"></section>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def encontrarIndividuo(self, regioes, prob):
  for i in range(len(self.individuos)):
    if regioes[i][0] &lt;= prob and regioes[i][1] &gt;= prob:
      return i
  return None</code></pre>
</details>
</dd>
<dt id="MainSystem.controller.states.debugHLC.AG.reproduzir"><code class="name flex">
<span>def <span class="ident">reproduzir</span></span>(<span>self)</span>
</code></dt>
<dd>
<section class="desc"></section>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def reproduzir(self):
  somaAdequacao = self.corrigirAdequacao()
  
  print(&#34;Resultado indivíduos:&#34;)
  for individuo in sorted(self.individuos, key=lambda x:-x.adequacao):
    print(&#34;Adequação: {3}\tka: {0}\tkg: {1}\tkp: {2}&#34;.format(individuo.ka, individuo.kg, individuo.kp, individuo.adequacao))
    
  listaRegiaoProb = []
  probAnt = 0
  for i in range(len(self.individuos)):
    prob = self.individuos[i].adequacao/somaAdequacao
    listaRegiaoProb.append((probAnt,probAnt+prob))
    probAnt = probAnt+prob
    
  print(listaRegiaoProb)
  
  pais = []
  maes = []
  for i in range(len(self.individuos)//2):
    pais.append(self.individuos[self.encontrarIndividuo(listaRegiaoProb, np.random.rand())])
    maes.append(self.individuos[self.encontrarIndividuo(listaRegiaoProb, np.random.rand())])
  
  novosIndividuos = []
  for i in range(len(self.individuos)//2):
    pc = np.random.rand()
    if pc &gt; 0.7:
      locus = np.random.randint(3)+1
      novosIndividuos.append(Individuo(pais[i].params[:locus]+maes[i].params[locus:3]))
      novosIndividuos.append(Individuo(maes[i].params[:locus]+pais[i].params[locus:3]))
    else:
      novosIndividuos.append(Individuo(pais[i].params))
      novosIndividuos.append(Individuo(maes[i].params))
    
    for j in range(len(novosIndividuos[-1].params)):
      pm1 = np.random.rand()
      pm2 = np.random.rand()
      if pm1 &gt; 0.97:
        novosIndividuos[-1].params[j] = self.weights[j] * np.random.rand() + self.min[j]
      if pm2 &gt; 0.97:
        novosIndividuos[-2].params[j] = self.weights[j] * np.random.rand() + self.min[j]
  
  print(&#34;Novos indivíduos:&#34;)
  for individuo in novosIndividuos:
    print(&#34;ka: {0}\tkg: {1}\tkp: {2}&#34;.format(individuo.ka, individuo.kg, individuo.kp))
  
  self.individuos = novosIndividuos</code></pre>
</details>
</dd>
</dl>
</dd>
<dt id="MainSystem.controller.states.debugHLC.DebugHLC"><code class="flex name class">
<span>class <span class="ident">DebugHLC</span></span>
<span>(</span><span>controller)</span>
</code></dt>
<dd>
<section class="desc"><p>Estado de debug HLC. Executa a visão, define trajetórias específicas para os robôs, passa um target ao controle de alto nível e envia sinal via rádio.</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">class DebugHLC(State):
  &#34;&#34;&#34;Estado de debug HLC. Executa a visão, define trajetórias específicas para os robôs, passa um target ao controle de alto nível e envia sinal via rádio.&#34;&#34;&#34;
  
  def __init__(self, controller):
    super().__init__(controller)
    
    self.finalPoint = None
    self.ag = AG(20)
    self.adequacao = 0
    self.tin = 0
    

  def update(self):
    t0 = time.time()
    
    self._controller.visionSystem.update()
    
    robot = self._controller.world.robots[0]
    
    
    
    if self.finalPoint is None or (robot.x-self.finalPoint[0])**2 + (robot.y-self.finalPoint[1])**2 &lt; 0.07**2 or time.time()-self.tin &gt;= 5:
      
      if self._controller.world.running:
        # Fim do experimento
        #if self.tin != 0:
          #self.adequacao = self.adequacao + 50*(time.time()-self.tin)
          #print(&#34;Não adequação: &#34; + str(self.adequacao))
          #self.ag.setAdequacao(self.adequacao)
          #self.adequacao = 0
          #self._controller.communicationSystem.sendZero()
        
        # Inicio do experimento
        self.tin = time.time()
        #individuo = self.ag.getIndividuo()
        #self._controller.controlSystem.setConstantes(individuo.ka, individuo.kg, individuo.kp)
      
      self.finalPoint = (-np.sign(robot.x)*self._controller.world.field_x_length/2*0.70, 0, -np.pi/2)
      self.trajectory = Dubins(robot.pose, self.finalPoint, 0.15)
      
      #self.trajectory = StraightLine(robot.pose, (-robot.x, robot.y, -np.pi/2))
    
#    # Integra a adequacao do experimento
#    if self._controller.world.running:
#      rmin = self.trajectory.P(self.trajectory.tmin(robot.pose))
#      p = np.sqrt((robot.x-rmin[0])**2 + (robot.y-rmin[1])**2)
#      a = rmin[2]-robot.th
#      self.adequacao = self.adequacao + (p + abs(np.sin(a))/2)
    
    # Define uma trajetória
    robot.trajectory = self.trajectory
    
    # Obtém o target instantâneo
    targets = [robot.trajectory.target(robot.pose, robot.step)]
    
    # Obtém velocidade angular e linear
    speeds = self._controller.controlSystem.actuate(targets, [])
    
    # Envia os dados via rádio
    if self._controller.world.running:
      self._controller.communicationSystem.send(speeds)
    else: self._controller.communicationSystem.sendZero()</code></pre>
</details>
<h3>Ancestors</h3>
<ul class="hlist">
<li>controller.states.State</li>
<li>abc.ABC</li>
</ul>
<h3>Methods</h3>
<dl>
<dt id="MainSystem.controller.states.debugHLC.DebugHLC.update"><code class="name flex">
<span>def <span class="ident">update</span></span>(<span>self)</span>
</code></dt>
<dd>
<section class="desc"><p>O estado deve implementar um método de <code>update</code> que será executado continuamente pela thread de backend</p></section>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">  def update(self):
    t0 = time.time()
    
    self._controller.visionSystem.update()
    
    robot = self._controller.world.robots[0]
    
    
    
    if self.finalPoint is None or (robot.x-self.finalPoint[0])**2 + (robot.y-self.finalPoint[1])**2 &lt; 0.07**2 or time.time()-self.tin &gt;= 5:
      
      if self._controller.world.running:
        # Fim do experimento
        #if self.tin != 0:
          #self.adequacao = self.adequacao + 50*(time.time()-self.tin)
          #print(&#34;Não adequação: &#34; + str(self.adequacao))
          #self.ag.setAdequacao(self.adequacao)
          #self.adequacao = 0
          #self._controller.communicationSystem.sendZero()
        
        # Inicio do experimento
        self.tin = time.time()
        #individuo = self.ag.getIndividuo()
        #self._controller.controlSystem.setConstantes(individuo.ka, individuo.kg, individuo.kp)
      
      self.finalPoint = (-np.sign(robot.x)*self._controller.world.field_x_length/2*0.70, 0, -np.pi/2)
      self.trajectory = Dubins(robot.pose, self.finalPoint, 0.15)
      
      #self.trajectory = StraightLine(robot.pose, (-robot.x, robot.y, -np.pi/2))
    
#    # Integra a adequacao do experimento
#    if self._controller.world.running:
#      rmin = self.trajectory.P(self.trajectory.tmin(robot.pose))
#      p = np.sqrt((robot.x-rmin[0])**2 + (robot.y-rmin[1])**2)
#      a = rmin[2]-robot.th
#      self.adequacao = self.adequacao + (p + abs(np.sin(a))/2)
    
    # Define uma trajetória
    robot.trajectory = self.trajectory
    
    # Obtém o target instantâneo
    targets = [robot.trajectory.target(robot.pose, robot.step)]
    
    # Obtém velocidade angular e linear
    speeds = self._controller.controlSystem.actuate(targets, [])
    
    # Envia os dados via rádio
    if self._controller.world.running:
      self._controller.communicationSystem.send(speeds)
    else: self._controller.communicationSystem.sendZero()</code></pre>
</details>
</dd>
</dl>
</dd>
</dl>
</section>
</article>
<nav id="sidebar">
<h1>Index</h1>
<div class="toc">
<ul></ul>
</div>
<ul id="index">
<li><h3>Super-module</h3>
<ul>
<li><code><a title="MainSystem.controller.states" href="index.html">MainSystem.controller.states</a></code></li>
</ul>
</li>
<li><h3><a href="#header-classes">Classes</a></h3>
<ul>
<li>
<h4><code><a title="MainSystem.controller.states.debugHLC.Individuo" href="#MainSystem.controller.states.debugHLC.Individuo">Individuo</a></code></h4>
<ul class="">
<li><code><a title="MainSystem.controller.states.debugHLC.Individuo.ka" href="#MainSystem.controller.states.debugHLC.Individuo.ka">ka</a></code></li>
<li><code><a title="MainSystem.controller.states.debugHLC.Individuo.kg" href="#MainSystem.controller.states.debugHLC.Individuo.kg">kg</a></code></li>
<li><code><a title="MainSystem.controller.states.debugHLC.Individuo.kp" href="#MainSystem.controller.states.debugHLC.Individuo.kp">kp</a></code></li>
</ul>
</li>
<li>
<h4><code><a title="MainSystem.controller.states.debugHLC.AG" href="#MainSystem.controller.states.debugHLC.AG">AG</a></code></h4>
<ul class="">
<li><code><a title="MainSystem.controller.states.debugHLC.AG.setAdequacao" href="#MainSystem.controller.states.debugHLC.AG.setAdequacao">setAdequacao</a></code></li>
<li><code><a title="MainSystem.controller.states.debugHLC.AG.getIndividuo" href="#MainSystem.controller.states.debugHLC.AG.getIndividuo">getIndividuo</a></code></li>
<li><code><a title="MainSystem.controller.states.debugHLC.AG.corrigirAdequacao" href="#MainSystem.controller.states.debugHLC.AG.corrigirAdequacao">corrigirAdequacao</a></code></li>
<li><code><a title="MainSystem.controller.states.debugHLC.AG.encontrarIndividuo" href="#MainSystem.controller.states.debugHLC.AG.encontrarIndividuo">encontrarIndividuo</a></code></li>
<li><code><a title="MainSystem.controller.states.debugHLC.AG.reproduzir" href="#MainSystem.controller.states.debugHLC.AG.reproduzir">reproduzir</a></code></li>
</ul>
</li>
<li>
<h4><code><a title="MainSystem.controller.states.debugHLC.DebugHLC" href="#MainSystem.controller.states.debugHLC.DebugHLC">DebugHLC</a></code></h4>
<ul class="">
<li><code><a title="MainSystem.controller.states.debugHLC.DebugHLC.update" href="#MainSystem.controller.states.debugHLC.DebugHLC.update">update</a></code></li>
</ul>
</li>
</ul>
</li>
</ul>
</nav>
</main>
<footer id="footer">
<p>Generated by <a href="https://pdoc3.github.io/pdoc"><cite>pdoc</cite> 0.7.2</a>.</p>
</footer>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
<script>hljs.initHighlightingOnLoad()</script>
</body>
</html>